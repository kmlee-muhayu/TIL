# Mysql JSON 데이터 관련 함수
* 본 함수들은 JSON 값에 대한 검색이나 비교 작업을 수행하여 데이터를 추출하고, 해당 값의 데이터 경로를 알려준다.
* 본 함수들은 Mysql 8.0.17 버전부터 사용한다.

### JSON 데이터 관련 함수
##### JSON_CONTAINS()
```
mysql> SET @j = '{"a": 1, "b": 2, "c": {"d": 4}}';
mysql> SET @j2 = '1';
mysql > SELECT JSON_CONTAINS(@j, @j2, '$.a');
----------------------------------
| JSON_CONTAINS(@j, @j2, '$.a') |
----------------------------------
|                             1 |
----------------------------------
```
* `@j2 = 1` 값이 초기화되어 있고 `@j`에서 `"a": 1` 로 정의되어 있으므로 `a = 1`, 즉 참이다. (true = 1)
```
mysql > SELECT JSON_CONTAINS(@j, @j2, '$.b');
----------------------------------
| JSON_CONTAINS(@j, @j2, '$.b') |
----------------------------------
|                             0 |
----------------------------------
```
* `"b": 2` 이므로 1이 아니다. 즉 거짓이다. (false = 0)

##### JSON_CONTAINS_PATH()
```
mysql> SET @j = '{"a": 1, "b": 2, "c": {"d": 4}}';
mysql> SELECT JSON_CONTAINS_PATH(@j, 'one', '$.a', '$.e');
-----------------------------------------------
| JSON_CONTAINS_PATH(@j, 'one', '$.a', '$.e') |
-----------------------------------------------
|                                           1 |
-----------------------------------------------

mysql> SET @j = '{"a": 1, "b": 2, "c": {"d": 4}}';
mysql> SELECT JSON_CONTAINS_PATH(@j, 'all', '$.a', '$.e');
-----------------------------------------------
| JSON_CONTAINS_PATH(@j, 'all', '$.a', '$.e') |
-----------------------------------------------
|                                           0 |
-----------------------------------------------
```
* 'one': 문서 내에 경로가 하나 이상 존재하는 경우 1, 그렇지 않으면 0
* 'all': 문서 내에 모든 경로가 존재하는 경우 1, 그렇지 않은 경우 0
  * 위 예제의 `@j`에서 `"a"`는 존재하고 `"e"`는 존재하지 않음, 즉 하나 이상 존재하기 때문에 'one'에서는 true (= 1)
  * 위 예제의 `@j`에서 `"a"`는 존재하고 `"e"`는 존재하지 않음, 즉 모두 존재하지는 않기 때문에 'all'에서는 false (= 0)

##### JSON_EXTRACT()
```
mysql> SELECT JSON_EXTRACT('[10, 20, [30, 40]]', '$[1]');
----------------------------------------------
| JSON_EXTRACT('[10, 20, [30, 40]]', '$[1]') |
----------------------------------------------
| 20                                         |
----------------------------------------------

mysql> SELECT JSON_EXTRACT('[10, 20, [30, 40]]', '$[1]', '$[0]');
------------------------------------------------------
| JSON_EXTRACT('[10, 20, [30, 40]]', '$[1]', '$[0]') |
------------------------------------------------------
| [20, 10]                                           |
------------------------------------------------------

mysql> SELECT JSON_EXTRACT('[10, 20, [30, 40]]', '$[2][*]');
-------------------------------------------------
| JSON_EXTRACT('[10, 20, [30, 40]]', '$[2][*]') |
-------------------------------------------------
| [30, 40]                                      |
-------------------------------------------------
```
* JSON 문서에서 인수와 일치하는 위치에 있는 데이터를 추출해서 반환한다. 인수가 null이거나 없으면 null을 반환한다.
* 올바른 JSON 문서가 아니거나 위치 인수가 올바른 표현이 아닌 경우 오류가 발생한다.

##### JSON_KEYS()
```
mysql> SELECT JSON_KEYS('{"a": 1, "b": {"c": 30}}');
-----------------------------------------
| JSON_KEYS('{"a": 1, "b": {"c": 30}}') |
-----------------------------------------
| ["a", "b"]                            |
-----------------------------------------

mysql> SELECT JSON_KEYS('{"a": 1, "b": {"c": 30}}', '$.b');
------------------------------------------------
| JSON_KEYS('{"a": 1, "b": {"c": 30}}', '$.b') |
------------------------------------------------
| ["c"]                                        |
------------------------------------------------
```
* 이중 JSON 구문의 문서에서 인수로 해당 JSON의 키 값을 넘겨주면 이중 구문 안의 키들을 반환한다.

##### JSON_SEARCH()
```
mysql> SET @j = '["abc", [{"k": "10"}, "def"], {"x":"abc"}, {"y":"bcd"}]';
mysql> SELECT JSON_SEARCH(@j, 'one', 'abc');
---------------------------------
| JSON_SEARCH(@j, 'one', 'abc') |
---------------------------------
| "$[0]"                        |
---------------------------------

mysql> SELECT JSON_SEARCH(@j, 'all', 'abc');
-----------------------------------------
| SELECT JSON_SEARCH(@j, 'all', 'abc'); |
-----------------------------------------
| "$[0]", "$[2].x"                      |
-----------------------------------------

mysql> SELECT JSON_SEARCH(@j, 'all', 'ghi');
----------------------------------
| JSON_SEARCH(@j, 'all', 'ghi'); |
----------------------------------
| NULL                           |
----------------------------------

mysql> SELECT JSON_SEARCH(@j, 'all', '10');
---------------------------------
| JSON_SEARCH(@j, 'all', '10'); |
---------------------------------
| "$[1][0].k"                   |
---------------------------------
```
* 'one': 첫 번째로 일치하는 하나의 위치 문자열만 반환한다.
* 'all': 중복된 위치가 포함되지 않게 일치하는 모든 위치의 문자열 반환한다.

##### JSON_VALUE()
```
JSON_VALUE(json_doc, path [RETURNING type] [on_empty] [on_error])

on_empty:
    {NULL | ERROR | DEFAULT value} ON EMPTY

on_error:
    {NULL | ERROR | DEFAULT value} ON ERROR
```
* `json_doc`: 유효한 JSON 문서. NULL이면 함수는 NULL을 반환한다.
* `path`: 문서의 한 위치를 가리키는 JSON 경로. 문자열 리터럴 값
* `on_empty`를 지정하면 경로에 데이터가 없을 때 `JSON_VALUE()` 동작을 결정한다.
  * NULL ON EMPTY: 함수가 NULL을 반환. 기본적인 `on_empty` 동작
  * DEFAULT value ON EMPTY: 제공된 value 값이 반환된다. 값의 타입은 `[RETURNING type]`과 같아야 한다.
  * ERROR ON EMPTY: 함수가 오류를 발생시킨다.
* `on_erro`는 오류가 발생할 때 해당 결과와 함께 다음 값 중 하나를 결정한다.
  * NULL ON ERROR: JSON_VALUE()는 NULL을 반환. `on_error`절이 사용되지 않을 경우 기본 동작
  * DEFAULT value ON ERROR: value 값이 반환되며, 값의 타입은 `[RETURNING type]`과 같아야 한다.
  * ERROR ON ERROR: 오류를 발생시킨다.
